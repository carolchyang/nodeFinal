"use strict";(self["webpackChunknode_final"]=self["webpackChunknode_final"]||[]).push([[547],{6462:function(e,t,a){var o=a(3766),n=a(3248),s=a(6294);const i=(0,s.Z)();t["Z"]=(0,o.Q_)("followStore",{state:()=>({follows:[],followArray:[]}),actions:{async getFollows(e){let t=e||{};t={pageCount:100,page:e?.page||1,reverse:0==e?.reverse?0:1},await(0,n.fe)(t).then((e=>{this.follows=e.data.data.data,this.getFollowArray()})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"取得追蹤名單失敗"})}))},async createFollow(e){await(0,n.lC)({targetUserId:e}).then((()=>{i.pushMessage({style:"dark",content:"已追蹤"})})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"新增追蹤失敗"})}))},async delFollow(e){await(0,n.Ac)(e).then((()=>{i.pushMessage({style:"dark",content:"取消追蹤成功"})})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"取消追蹤失敗"})}))},getFollowArray(){const e=[];this.follows.forEach((t=>{e.push({followId:t._id,targetUserId:t.targetUserId._id})})),this.followArray=e}}})},6059:function(e,t,a){a.d(t,{Z:function(){return f}});var o=a(3396),n=a(7139),s=a(9242);const i={"aria-label":"Page navigation"},l={class:"pagination justify-content-center"},r=(0,o._)("span",{"aria-hidden":"true"},"«",-1),d=[r],g=["onClick"],p=(0,o._)("span",{"aria-hidden":"true"},"»",-1),c=[p];function h(e,t,a,r,p,h){return(0,o.wg)(),(0,o.iD)("nav",i,[(0,o._)("ul",l,[(0,o._)("li",{class:(0,n.C_)(["page-item",{disabled:!(a.pagination.current_pages>1)}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,s.iM)((e=>h.changePage(a.pagination.current_pages-1)),["prevent"]))},d)],2),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pagination.total_pages,(e=>((0,o.wg)(),(0,o.iD)("li",{class:(0,n.C_)(["page-item",{active:a.pagination.current_pages==e}]),key:e},[(0,o._)("a",{class:"page-link",href:"#",onClick:(0,s.iM)((t=>h.changePage(e)),["prevent"])},(0,n.zw)(e),9,g)],2)))),128)),(0,o._)("li",{class:(0,n.C_)(["page-item",{disabled:!(a.pagination.current_pages<a.pagination.total_pages)}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,s.iM)((e=>h.changePage(a.pagination.current_pages+1)),["prevent"]))},c)],2)])])}var u={name:"PaginationComponent",props:["pagination"],emits:["get-all"],methods:{changePage(e=1){this.$emit("get-all",e,"loading")}}},m=a(89);const w=(0,m.Z)(u,[["render",h]]);var f=w},1164:function(e,t,a){a.r(t),a.d(t,{default:function(){return Q}});var o=a(3396),n=a(7139),s=a(9242),i=a(2893);const l={class:"header header-rounded d-flex mb-5"},r=["src"],d={key:1,src:i,class:"headerThumbnail"},g={class:"headerContent"},p={class:"text-start h5 fw-bold me-auto"},c=(0,o._)("span",{class:"d-block d-sm-block"},"的貼文牆",-1),h={key:0},u={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},m=(0,o.Uk)(" 追蹤 "),w={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},f=(0,o.Uk)(" 取消追蹤 "),k={class:"row g-3 mb-4"},y={class:"col-12 col-md-4"},_=(0,o._)("option",{value:"1"},"由新到舊",-1),b=(0,o._)("option",{value:"0"},"由舊到新",-1),v=[_,b],C={class:"col-12 col-md-8"},I={class:"input-group input-group-sm"},L=(0,o._)("i",{class:"bi bi-search h3"},null,-1),P=[L],A=(0,o.Uk)("目前尚無動態，趕快叫他新增貼文吧！"),D=(0,o.Uk)(" 確定要刪除此則 "),Z={class:"text-danger"},F=(0,o.Uk)(" ？（刪除後無法回復） ");function M(e,t,a,i,_,b){const L=(0,o.up)("ArticleComponent"),M=(0,o.up)("EmptyCardComponent"),U=(0,o.up)("PaginationComponent"),x=(0,o.up)("DelModalComponent");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",l,[e.personalInfo.photo?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.personalInfo.photo,class:"headerThumbnail"},null,8,r)):((0,o.wg)(),(0,o.iD)("img",d)),(0,o._)("div",g,[(0,o._)("h2",p,[(0,o._)("span",null,(0,n.zw)(e.personalInfo.name),1),c]),e.personalInfo._id!==e.profile._id?((0,o.wg)(),(0,o.iD)("div",h,[b.isFollow?((0,o.wg)(),(0,o.iD)("button",{key:1,type:"button",class:"btn btn-secondary py-2 px-4 px-sm-8 border-dark fw-bold shadow",onClick:t[1]||(t[1]=(0,s.iM)((t=>b.toggleFollow(e.personalInfo._id,"del")),["prevent"]))},["follow"==e.partLoading.type&&e.partLoading.id==e.personalInfo._id?((0,o.wg)(),(0,o.iD)("span",w)):(0,o.kq)("",!0),f])):((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-warning py-2 px-6 px-sm-8 border-dark fw-bold shadow",onClick:t[0]||(t[0]=(0,s.iM)((t=>b.toggleFollow(e.personalInfo._id,"create")),["prevent"]))},["follow"==e.partLoading.type&&e.partLoading.id==e.personalInfo._id?((0,o.wg)(),(0,o.iD)("span",u)):(0,o.kq)("",!0),m]))])):(0,o.kq)("",!0)])]),(0,o._)("div",k,[(0,o._)("div",y,[(0,o.wy)((0,o._)("select",{class:"form-select form-select-sm","onUpdate:modelValue":t[2]||(t[2]=e=>_.reverse=e),onChange:t[3]||(t[3]=e=>b.getAll(1,"loading"))},v,544),[[s.bM,_.reverse]])]),(0,o._)("div",C,[(0,o._)("div",I,[(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","aria-label":"search","aria-describedby":"search","onUpdate:modelValue":t[4]||(t[4]=e=>_.keyword=e)},null,512),[[s.nr,_.keyword,void 0,{trim:!0}]]),(0,o._)("button",{class:"effectBtn btn btn-primary py-0 px-3",type:"button",id:"search",onClick:t[5]||(t[5]=(0,s.iM)((e=>b.getAll(1,"loading")),["prevent"]))},P)])])]),e.posts.length?((0,o.wg)(),(0,o.j4)(L,{key:0,data:e.posts,profile:e.profile,onToggleLike:b.toggleLike,onUpdateComments:b.updateComments},null,8,["data","profile","onToggleLike","onUpdateComments"])):((0,o.wg)(),(0,o.j4)(M,{key:1},{default:(0,o.w5)((()=>[A])),_:1})),e.posts.length?((0,o.wg)(),(0,o.j4)(U,{key:2,pagination:e.pagination,onGetAll:b.getAll},null,8,["pagination","onGetAll"])):(0,o.kq)("",!0),(0,o.Wm)(x,{onDelData:b.delData},{default:(0,o.w5)((()=>[D,(0,o._)("b",Z,(0,n.zw)(e.modal.title),1),F])),_:1},8,["onDelData"])],64)}a(6699);var U=a(6511),x=a(7729),W=a(6059),E=a(2312),j=a(3766),q=a(6294),T=a(2323),z=a(4331),V=a(7484),$=a(6634),G=a(407),H=a(6462),Y=a(3248),B={name:"DynamicWallView",data(){return{personalId:"",keyword:"",reverse:1}},watch:{postIds(){Y.Wb.emit("register",this.postIds)}},methods:{async getAll(e=1,t){t&&this.toggleLoading(!0);const a={};a.page=e,a.reverse=this.reverse,a.userId=this.personalId,a.content=this.keyword,await this.getPosts(a),this.toggleLoading(!1)},async delData(){this.togglePartLoading(this.modal.id,this.modal.type);let e="delComment",t=this.pagination?.current_pages;"delpost"==this.modal.type&&(e="delPost",t=1),await this[e](this.modal.id),await this.getAll(t),this.togglePartLoading("","")},async toggleLike({id:e,type:t}){this.togglePartLoading(e,"like");let a="clickLike";"cancel"==t&&(a="delLike"),await this[a](e),await this.getAll(this.pagination?.current_pages),this.togglePartLoading("","")},async toggleFollow(e,t){this.togglePartLoading(e,"follow");let a="",o="";"del"==t?(a="delFollow",this.followArray.forEach((t=>{t.targetUserId==e&&(o=t.followId)}))):(a="createFollow",o=e),await this[a](o),await this.getFollows(),this.togglePartLoading("","")},async updateComments(e){this.togglePartLoading(e.postId,"comment"),await this.createComment(e),await this.getAll(this.pagination?.current_pages),this.togglePartLoading("","")},...(0,j.nv)(q.Z,["toggleLoading","togglePartLoading"]),...(0,j.nv)(V.Z,["getPosts","delPost"]),...(0,j.nv)($.Z,["clickLike","delLike"]),...(0,j.nv)(G.Z,["createComment","delComment"]),...(0,j.nv)(H.Z,["getFollows","createFollow","delFollow"])},computed:{isFollow(){let e=!1;return this.followArray.forEach((t=>{t.targetUserId==this.personalInfo?._id&&(e=!0)})),e},postIds(){return this.posts.map((e=>e.id))},...(0,j.rn)(T.Z,["modal"]),...(0,j.rn)(q.Z,["partLoading"]),...(0,j.rn)(z.Z,["profile","personalInfo"]),...(0,j.rn)(V.Z,["posts","pagination"]),...(0,j.rn)(H.Z,["follows","followArray"])},components:{ArticleComponent:U.Z,EmptyCardComponent:x.Z,PaginationComponent:W.Z,DelModalComponent:E.Z},async created(){if(!this.personalInfo._id)return this.$router.push("/");this.toggleLoading(!0),this.personalId=this.$route.params.id,await this.getAll(),await this.getFollows(),this.toggleLoading(!1),Y.Wb.connect(),Y.Wb.on("addComment",(e=>{const t=this.posts.find((t=>t._id===e.postId));t.comments.unshift(e)})),Y.Wb.on("removeComment",(({postId:e,commentId:t})=>{if(!this.postIds.includes(e))return;const a=this.posts.find((t=>t._id===e)),o=a.comments.findIndex((e=>e._id===t));o>-1&&a.comments.splice(o,1)})),Y.Wb.on("updateLikeCount",(({isLike:e,userId:t,postId:a})=>{if(!this.postIds.includes(a))return;const o=this.posts.findIndex((e=>e._id===a)),n=this.posts[o].likeCount;e?n.push(t):n.splice(o,1)}))},unmounted(){Y.Wb.disconnect()}},K=a(89);const N=(0,K.Z)(B,[["render",M]]);var Q=N}}]);
//# sourceMappingURL=547.002eb8b0.js.map
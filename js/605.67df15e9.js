"use strict";(self["webpackChunknode_final"]=self["webpackChunknode_final"]||[]).push([[605],{4331:function(e,a,t){var o=t(1120),s=t(3766),l=t(3248),n=t(6294),d=t(2323),r=t(7965);const i=(0,n.Z)(),m=(0,d.Z)();a["Z"]=(0,s.Q_)("userStore",{state:()=>({profile:{name:"",photo:"",gender:"",_id:""},tempProfile:{name:"",photo:"",gender:""},personalInfo:{name:"",photo:"",_id:""}}),actions:{signIn(e,a){i.toggleLoading(!0),(0,l.TV)(a).then((a=>{const{token:t}=a.data.data;(0,r.o4)(t),e.resetForm(),i.toggleLoading(!1),o.Z.push({name:"DynamicWallView"})})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"登入失敗"}),i.toggleLoading(!1)}))},signUp(e,a){i.toggleLoading(!0),(0,l.pY)(a).then((a=>{const{token:t}=a.data.data;(0,r.o4)(t),e.resetForm(),i.pushMessage({style:"dark",content:"註冊成功"}),i.toggleLoading(!1),o.Z.push({name:"DynamicWallView"})})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"註冊失敗"}),i.toggleLoading(!1)}))},async getProfile(){i.isLoading=!0,await(0,l.TY)().then((e=>{this.profile=e.data.data,this.updateProfileData(this.profile),i.isLoading=!1})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"取得個人資料失敗，請重新登入"}),i.isLoading=!1,(0,r.qz)(),o.Z.push("/signin")}))},async updateProfile(e){i.toggleLoading(!0),await(0,l.MH)(e).then((e=>{this.profile=e.data.data.user,this.updateProfileData(this.profile),m.toggleMsgModal({title:"更新個人資料",content:"已成功更新您的個人資料~"}),i.toggleLoading(!1)})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"更新失敗"}),i.toggleLoading(!1)}))},async updatePassword(e,a){i.toggleLoading(!0),await(0,l.HS)(a).then((()=>{e.resetForm(),m.toggleMsgModal({title:"更新密碼成功",content:"下次登入記得使用新密碼喔~"}),i.toggleLoading(!1)})).catch((e=>{i.pushMessage({style:"danger",content:e.response?.data?.message||"更新密碼失敗"}),i.toggleLoading(!1)}))},async sendForgetEmail(e){i.toggleLoading(!0),await(0,l.ZP)(e).then((()=>{m.toggleMsgModal({title:"信件已寄出，請收取郵件",content:"請至信箱收取重設密碼信，若 1 天內沒收到信再請嘗試一次~"}),i.toggleLoading(!1)})).catch((e=>{m.toggleMsgModal({title:"驗證信箱失敗",content:e.response?.data?.message||"驗證信箱失敗，再請確認信箱"}),i.toggleLoading(!1)}))},async modifyPassword(e,a){i.toggleLoading(!0),await(0,l.$F)(e,a).then((()=>{m.toggleMsgModal({title:"重設密碼成功",content:"請使用新密碼登入喔~"}),o.Z.push("/signin"),i.toggleLoading(!1)})).catch((e=>{m.toggleMsgModal({title:"重設密碼失敗",content:e.response?.data?.message||"重設密碼失敗"}),i.toggleLoading(!1)}))},updateProfileData(e){this.tempProfile={name:e.name,photo:e.photo,gender:e.gender}},togglePersonalInfo(e){this.personalInfo=e}}})},9817:function(e,a,t){t.d(a,{Z:function(){return c}});var o=t(3396);const s={class:"modal fade",id:"msgModal",tabindex:"-1","aria-labelledby":"msgModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-hidden":"false"},l={class:"modal-dialog modal-dialog-centered"},n={class:"modal-content"},d={class:"modal-body pb-0 text-center"},r=(0,o._)("div",{class:"modal-footer justify-content-center"},[(0,o._)("button",{type:"button",class:"btn btn-primary py-2 px-8","data-bs-dismiss":"modal"}," 確定 ")],-1);function i(e,a,t,i,m,g){return(0,o.wg)(),(0,o.iD)("div",s,[(0,o._)("div",l,[(0,o._)("div",n,[(0,o._)("div",d,[(0,o.WI)(e.$slots,"default")]),r])])])}var m={name:"MsgModalComponent"},g=t(89);const p=(0,g.Z)(m,[["render",i]]);var c=p},4605:function(e,a,t){t.r(a),t.d(a,{default:function(){return $}});var o=t(3396),s=t(7139);const l=(0,o._)("h1",{class:"header"},"修改個人資料",-1),n={class:"navTab"},d={class:"nav nav-tabs",id:"nav-tab",role:"tablist"},r={class:"tab-content navTabContent",id:"nav-tabContent"},i={class:"tab-pane fade show active px-4 py-8 px-md-8",id:"nav-profile",role:"tabpanel","aria-labelledby":"nav-profile-tab"},m={class:"fileBtn text-center mb-4"},g=(0,o._)("label",{for:"photo"},"上傳大頭照",-1),p={class:"d-block mt-2 text-danger"},c={class:"mb-4"},u=(0,o._)("label",{for:"nickname",class:"form-label"},"暱稱",-1),f={class:"mb-8"},b=(0,o._)("h3",{class:"mb-2 h5 fw-normal"},"性別",-1),h={class:"form-check form-check-inline me-6"},v=(0,o._)("label",{class:"form-check-label",for:"male"},"男生",-1),w={class:"form-check form-check-inline"},y=(0,o._)("label",{class:"form-check-label",for:"female"},"女生",-1),_=(0,o._)("small",{class:"d-block mb-4 text-center text-danger"},null,-1),P=["disabled"],k={class:"tab-pane fade px-4 py-8 px-md-8",id:"nav-password",role:"tabpanel","aria-labelledby":"nav-password-tab"},M={class:"mb-4"},L=(0,o._)("label",{for:"password",class:"form-label"},"密碼",-1),F={class:"mb-8"},V=(0,o._)("label",{for:"confirmed",class:"form-label"},"確認密碼",-1),C=["disabled"],x={class:"mb-5"},I={class:"text-gray-700"};function Z(e,a,t,Z,W,D){const U=(0,o.up)("VField"),q=(0,o.up)("error-message"),S=(0,o.up)("VForm"),z=(0,o.up)("MsgModalComponent");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l,(0,o._)("nav",n,[(0,o._)("div",d,[(0,o._)("button",{class:"nav-link active",id:"nav-profile-tab","data-bs-toggle":"tab","data-bs-target":"#nav-profile",type:"button",role:"tab","aria-controls":"nav-profile","aria-selected":"true",onClick:a[0]||(a[0]=e=>D.toggleForm("profile"))}," 修改資料 "),(0,o._)("button",{class:"nav-link",id:"nav-password-tab","data-bs-toggle":"tab","data-bs-target":"#nav-password",type:"button",role:"tab","aria-controls":"nav-password","aria-selected":"false",onClick:a[1]||(a[1]=e=>D.toggleForm("password"))}," 重設密碼 ")])]),(0,o._)("div",r,[(0,o._)("div",i,[(0,o.Wm)(S,{id:"profileForm",enctype:"multipart/form-data",onSubmit:D.submitProfile,ref:"profileForm"},{default:(0,o.w5)((({errors:t,meta:l})=>[W.tempImg.photo?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"bgCoverRounded mx-auto mb-4",style:(0,s.j5)({backgroundImage:"url("+W.tempImg.photo+")"})},null,4)):e.profile.photo?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"bgCoverRounded mx-auto mb-4",style:(0,s.j5)({backgroundImage:"url("+e.profile.photo+")"})},null,4)):((0,o.wg)(),(0,o.iD)("div",{key:2,class:(0,s.C_)(["bgCoverRounded mx-auto mb-4",{profileUserPhoto:!W.tempImg.photo}])},null,2)),(0,o._)("div",m,[g,(0,o._)("input",{type:"file",accept:"image/*",id:"photo",name:"photo",onChange:a[2]||(a[2]=(...e)=>D.uploadFile&&D.uploadFile(...e))},null,32),(0,o._)("small",p,(0,s.zw)(W.tempImg.msg),1)]),(0,o._)("div",c,[u,(0,o.Wm)(U,{type:"text",id:"name",placeholder:"請輸入暱稱",name:"name",class:(0,s.C_)(["form-control",{"is-invalid":t["name"]}]),rules:"nickanem:8",modelValue:e.tempProfile.name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.tempProfile.name=a),required:""},null,8,["class","modelValue"]),(0,o.Wm)(q,{name:"name",class:"invalid-feedback text-danger"})]),(0,o._)("div",f,[b,(0,o._)("div",h,[(0,o.Wm)(U,{type:"radio",id:"male",name:"gender",class:"form-check-input",value:"male",modelValue:e.tempProfile.gender,"onUpdate:modelValue":a[4]||(a[4]=a=>e.tempProfile.gender=a)},null,8,["modelValue"]),v]),(0,o._)("div",w,[(0,o.Wm)(U,{type:"radio",id:"female",name:"gender",class:"form-check-input",value:"female",modelValue:e.tempProfile.gender,"onUpdate:modelValue":a[5]||(a[5]=a=>e.tempProfile.gender=a)},null,8,["modelValue"]),y])]),_,(0,o._)("button",{type:"submit",class:"effectBtn btn btn-primary w-100",disabled:!l.valid}," 送出更新 ",8,P)])),_:1},8,["onSubmit"])]),(0,o._)("div",k,[(0,o.Wm)(S,{onSubmit:D.submitPassword,ref:"passwordForm"},{default:(0,o.w5)((({errors:e,meta:t})=>[(0,o._)("div",M,[L,(0,o.Wm)(U,{type:"password",id:"password",placeholder:"請輸入密碼",name:"密碼",class:(0,s.C_)(["form-control",{"is-invalid":e["密碼"]}]),rules:"required|password:8",modelValue:W.tempPassword.password,"onUpdate:modelValue":a[6]||(a[6]=e=>W.tempPassword.password=e),required:""},null,8,["class","modelValue"]),(0,o.Wm)(q,{name:"密碼",class:"invalid-feedback text-danger"})]),(0,o._)("div",F,[V,(0,o.Wm)(U,{type:"password",id:"confirmed",placeholder:"請再次輸入密碼",name:"確認密碼",class:(0,s.C_)(["form-control",{"is-invalid":e["確認密碼"]}]),rules:"required|confirmed:@密碼",modelValue:W.tempPassword.passwordConfirm,"onUpdate:modelValue":a[7]||(a[7]=e=>W.tempPassword.passwordConfirm=e),required:""},null,8,["class","modelValue"]),(0,o.Wm)(q,{name:"確認密碼",class:"invalid-feedback text-danger"})]),(0,o._)("button",{type:"submit",class:"effectBtn btn btn-primary w-100",disabled:!t.valid}," 重設密碼 ",8,C)])),_:1},8,["onSubmit"])])]),(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o._)("h3",x,(0,s.zw)(e.modal.title),1),(0,o._)("p",I,(0,s.zw)(e.modal.content),1)])),_:1})],64)}var W=t(9817),D=t(3766),U=t(6294),q=t(4331),S=t(2323),z={name:"ProfileView",data(){return{tempImg:{photo:this.profile?.photo||"",msg:""},tempPassword:{password:"",passwordConfirm:""}}},methods:{submitPassword(){const e=this.$refs.passwordForm;this.updatePassword(e,this.tempPassword)},uploadFile(e){this.tempImg={photo:this.profile?.photo||"",msg:""};const a=e.target.files[0];if(a){const{size:e,type:t}=a;t.startsWith("image/")?e>1048576?this.tempImg.msg="圖片檔案不能超過 1 MB":this.tempImg.photo=URL.createObjectURL(a):this.tempImg.msg="請確認圖片格式"}},toggleForm(e){"profile"==e?(this.$refs.profileForm.resetForm(),this.tempImg={photo:this.profile?.photo||"",msg:""},this.getProfile()):this.$refs.passwordForm.resetForm()},submitProfile(){const e=new FormData(document.getElementById("profileForm"));this.updateProfile(e)},...(0,D.nv)(U.Z,["pushMessage","toggleLoading"]),...(0,D.nv)(q.Z,["getProfile","updateProfile","updatePassword"]),...(0,D.nv)(S.Z,["toggleMsgModal"])},computed:{...(0,D.rn)(q.Z,["profile","tempProfile"]),...(0,D.rn)(S.Z,["modal"])},components:{MsgModalComponent:W.Z}},B=t(89);const R=(0,B.Z)(z,[["render",Z]]);var $=R}}]);
//# sourceMappingURL=605.67df15e9.js.map
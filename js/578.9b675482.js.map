{"version":3,"file":"js/578.9b675482.js","mappings":"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","sources":["webpack://node_final/./src/stores/postStore.js","webpack://node_final/./src/views/front/CreatePostView.vue","webpack://node_final/./src/views/front/CreatePostView.vue?303a"],"sourcesContent":["import router from \"@/router\";\nimport { defineStore } from \"pinia\";\nimport { apiGetPosts, apiCreatePost, apiDelPost } from \"@/scripts/api\";\nimport statusStore from \"./statusStore\";\nimport modalStore from \"./modalStore\";\n\nconst status = statusStore();\nconst modal = modalStore();\n\nexport default defineStore(\"postStore\", {\n  state: () => {\n    return {\n      posts: [],\n      pagination: {},\n      currentPostId: \"\",\n    };\n  },\n  actions: {\n    updateCurrentPostId(id) {\n      this.currentPostId = id;\n    },\n    // 取得貼文\n    async getPosts(data) {\n      // 使用 tempData 處理傳入的參數，避免傳進空值造成錯誤\n      let tempData = data || {};\n      tempData = {\n        // 每頁筆數(預設值 10)\n        pageCount: 5,\n        // 第幾頁\n        page: data?.page || 1,\n        // 排序類型(預設值 1) 1發文時間\n        sort: 1,\n        // 排序順序 1 新到舊 0 舊到新\n        reverse: data?.reverse == 0 ? 0 : 1,\n        // 關鍵字篩選 若沒有則返回所有貼文\n        content: data?.content,\n      };\n\n      // 指定使用者\n      if (data?.userId) {\n        tempData.userId = data.userId;\n        // 指定貼文\n      } else if (data?.postId) {\n        tempData.postId = data.postId;\n      }\n\n      await apiGetPosts(tempData)\n        .then((res) => {\n          this.posts = res.data.data.data;\n          this.pagination = res.data.data.pagination;\n        })\n        .catch((err) => {\n          status.pushMessage({\n            style: \"danger\",\n            content: err.response?.data?.message || \"取得貼文失敗\",\n          });\n        });\n    },\n    // 建立貼文\n    async createPost(data) {\n      await apiCreatePost(data)\n        .then(() => {\n          status.pushMessage({\n            style: \"dark\",\n            content: \"已建立貼文\",\n          });\n          router.push(\"/\");\n        })\n        .catch((err) => {\n          status.pushMessage({\n            style: \"danger\",\n            content: err.response?.data?.message || \"建立貼文失敗\",\n          });\n        });\n    },\n    // 刪除貼文\n    async delPost(id) {\n      await apiDelPost(id)\n        .then(() => {\n          /**\n           * 在動態牆執行刪除貼文\n           * 會執行 this.getPosts() 重新獲取 post 資料\n           */\n          modal.closeDelModal();\n          status.pushMessage({\n            style: \"dark\",\n            content: \"刪除貼文成功\",\n          });\n        })\n        .catch((err) => {\n          modal.closeDelModal();\n          status.pushMessage({\n            style: \"danger\",\n            content: err.response?.data?.message || \"刪除貼文失敗\",\n          });\n        });\n    },\n  },\n});\n","<template>\r\n  <h1 class=\"header\">張貼動態</h1>\r\n\r\n  <form\r\n    id=\"form\"\r\n    class=\"card p-md-8\"\r\n    enctype=\"multipart/form-data\"\r\n    @submit.prevent=\"submitPost\"\r\n  >\r\n    <div class=\"mb-4\">\r\n      <label for=\"content\" class=\"form-label\">貼文內容</label>\r\n      <textarea\r\n        name=\"content\"\r\n        id=\"content\"\r\n        class=\"form-control\"\r\n        rows=\"5\"\r\n        placeholder=\"輸入您的貼文內容\"\r\n      ></textarea>\r\n    </div>\r\n    <div class=\"fileBtn mb-4\" :class=\"{ 'mb-8': tempImg.url == '' }\">\r\n      <label for=\"img\" class=\"rounded-1\">上傳圖片</label>\r\n      <input\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        id=\"img\"\r\n        name=\"img\"\r\n        @change=\"uploadFile\"\r\n      />\r\n      <small class=\"ms-4 text-danger\">{{ tempImg.msg }}</small>\r\n    </div>\r\n    <div\r\n      class=\"bgCover position-relative mb-8\"\r\n      :style=\"{ backgroundImage: 'url(' + tempImg.url + ')' }\"\r\n      v-if=\"tempImg.url\"\r\n    >\r\n      <a href=\"#\" class=\"cardCloseBtn\" @click.prevent=\"resetImg\">\r\n        <i class=\"bi bi-x-lg\"></i>\r\n      </a>\r\n    </div>\r\n\r\n    <div class=\"text-center\">\r\n      <button type=\"submit\" class=\"effectBtn btn btn-primary w-100\">\r\n        送出貼文\r\n      </button>\r\n    </div>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions } from \"pinia\";\r\nimport postStore from \"@/stores/postStore\";\r\n\r\nexport default {\r\n  name: \"CreatePostView\",\r\n  data() {\r\n    return {\r\n      tempImg: {\r\n        url: \"\",\r\n        msg: \"\",\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    // 建立貼文\r\n    submitPost() {\r\n      const formData = new FormData(document.getElementById(\"form\"));\r\n      this.createPost(formData);\r\n    },\r\n    // 瀏覽圖片\r\n    uploadFile(e) {\r\n      // 先清空圖片資料\r\n\r\n      this.resetImg();\r\n      // 取得上傳的檔案\r\n      const file = e.target.files[0];\r\n\r\n      // 篩選圖片格式及大小\r\n      if (file) {\r\n        const { size, type } = file;\r\n        if (!type.startsWith(\"image/\")) {\r\n          this.tempImg.msg = \"請確認圖片格式\";\r\n        } else if (size > 1048576) {\r\n          this.tempImg.msg = \"圖片檔案不能超過 1 MB\";\r\n        } else {\r\n          // 放入瀏覽圖\r\n          this.tempImg.url = URL.createObjectURL(file);\r\n        }\r\n      }\r\n    },\r\n    // 重設圖片\r\n    resetImg() {\r\n      this.tempImg = {\r\n        url: \"\",\r\n        msg: \"\",\r\n      };\r\n    },\r\n    ...mapActions(postStore, [\"createPost\"]),\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.cardCloseBtn {\r\n  color: red;\r\n  font-size: 1.5rem;\r\n  &:hover {\r\n    transform: scale(1.25);\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./CreatePostView.vue?vue&type=template&id=92656e68&scoped=true\"\nimport script from \"./CreatePostView.vue?vue&type=script&lang=js\"\nexport * from \"./CreatePostView.vue?vue&type=script&lang=js\"\n\nimport \"./CreatePostView.vue?vue&type=style&index=0&id=92656e68&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\user\\\\Desktop\\\\Node.js 直播班\\\\小組\\\\期末小組\\\\node_final\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-92656e68\"]])\n\nexport default __exports__"],"names":["status","statusStore","modal","modalStore","defineStore","state","posts","pagination","currentPostId","actions","updateCurrentPostId","id","this","async","data","tempData","pageCount","page","sort","reverse","content","userId","postId","apiGetPosts","then","res","catch","err","pushMessage","style","response","message","apiCreatePost","router","apiDelPost","closeDelModal","_createElementVNode","class","for","name","rows","placeholder","_hoisted_5","type","_hoisted_1","enctype","onSubmit","$options","_hoisted_2","$data","url","_hoisted_3","accept","onChange","_toDisplayString","msg","_createElementBlock","backgroundImage","href","onClick","_hoisted_7","tempImg","methods","submitPost","formData","FormData","document","getElementById","createPost","uploadFile","e","resetImg","file","target","files","size","startsWith","URL","createObjectURL","mapActions","postStore","__exports__","render"],"sourceRoot":""}